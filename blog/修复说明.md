# Hugo 博客配置修复说明

## 🔴 发现的问题

### 1. 代码块多层嵌套和样式错误 ✅ 已修复
**原因**：同时启用了两种代码高亮方式
- **Pygments/Chroma**（Hugo内置，服务端渲染）：第12-15行
- **highlight.js**（客户端JavaScript）：第80行 `highlightInClient = true`

配置文件第11行的注释已明确警告：**不要同时启用两者！**

这导致代码块被处理两次，造成HTML多层嵌套和样式混乱。

### 2. 首页没有文章数据 ✅ 已修复
**原因**：主题模板与内容目录不匹配
- 内容位于：`content/posts/` 目录（复数）
- Hugo识别类型：`posts`
- 主题期望类型：`post`（单数）

主题的 `themes/even/layouts/index.html` 和 `post/summary.html` 都硬编码为处理 `post` 类型，而实际内容是 `posts` 类型。

## ✅ 已实施的修复

### 修复1：禁用客户端代码高亮
**文件**：`config.toml` 第80-81行

```toml
# 修改前：
highlightInClient = true

# 修改后：
# NOTE: 已禁用客户端高亮，避免与Chroma冲突导致代码多层嵌套
highlightInClient = false
```

**验证结果**：代码块HTML结构清晰，只有一层Chroma包装，无多层嵌套 ✅

### 修复2：创建posts类型的布局文件
创建了三个本地布局文件，适配 `posts` 类型的内容：

**文件1**：`layouts/index.html`
- 修改首页模板，使用 `.Site.RegularPages` 过滤 `posts` 类型的页面
- 排除section页面，只显示常规文章

**文件2**：`layouts/posts/summary.html`
- 复制自主题的 `post/summary.html`
- 修复了废弃的 `.URL` 为 `.Permalink`
- 用于首页文章摘要显示

**文件3**：`layouts/posts/single.html`
- 复制自主题的 `post/single.html`
- 修复了废弃的 `.URL` 为 `.Permalink`
- 用于文章详情页显示

**验证结果**：首页成功显示20篇最新文章，包含标题、日期、分类、摘要等信息 ✅

## 📋 已完成的步骤

### ✅ 重新生成网站
已使用Docker重新生成静态网站：
```bash
cd /data/hugo-blog
docker build -t hugo-blog .
docker run --rm -v $(pwd)/blog:/hugo-site hugo-blog hugo --cleanDestinationDir
```

**生成结果**：
- Pages: 226
- Paginator pages: 11（首页及分页）
- Non-page files: 105
- Static files: 42
- 生成时间: ~600ms

### ✅ 验证修复

已验证两个问题都已解决：

1. **首页数据显示** ✅
   - 首页成功显示20篇最新文章
   - 每篇文章包含：标题、日期、分类、字数、阅读时间、摘要
   - 示例文章：
     - "Linux服务器中git命令终端渲染出现问号" (2023-05-22)
     - "etcd和etcdKeeper的docker-compose的使用" (2023-02-24)

2. **代码高亮正常** ✅
   - 代码块HTML结构清晰：`<div class="highlight"><div class="chroma"><table>...`
   - 只有一层Chroma包装，无多层嵌套
   - 行号正常显示（使用表格布局）
   - 语法高亮CSS类正确应用

## 🚀 启动博客服务器

如需本地预览，可以使用以下命令启动开发服务器：

```bash
cd /data/hugo-blog
docker run --rm -p 1313:1313 -v $(pwd)/blog:/hugo-site hugo-blog \
  hugo server -w -b http://localhost:1313 --bind=0.0.0.0 --disableFastRender
```

然后访问：http://localhost:1313

## 📊 配置建议

当前配置使用Chroma（Hugo内置）进行代码高亮：
- ✅ `pygmentsCodefences = true` - 启用代码围栏
- ✅ `pygmentsUseClasses = true` - 使用CSS类
- ✅ `pygmentsOptions = "linenos=table"` - 行号显示为表格
- ✅ `highlightInClient = false` - 禁用客户端高亮

这是推荐的配置方式，性能更好且SEO友好。

## 🔍 其他注意事项

### 内容目录结构
```
content/
├── posts/          ← 主要内容（会显示在首页）
│   ├── docker/
│   ├── golang/
│   ├── nginx/
│   └── ...
└── post.bak/       ← 备份内容（不会显示）
```

### mainSections 配置
`config.toml` 第55行：
```toml
mainSections = ["post", "posts"]
```

虽然包含了两个值，但实际只有 `posts` 生效，因为只有这个目录存在。

---

修复完成时间：2025-10-21

